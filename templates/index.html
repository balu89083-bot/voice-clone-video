<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Cloning & Video Integration</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-microphone-alt"></i>
                <h1>Voice Cloning Studio</h1>
            </div>
            <p class="subtitle">Clone any voice and add it to your videos - Free & High Quality</p>
            <button class="btn btn-secondary btn-sm" id="clearAllBtn" style="margin-top: 10px;">
                <i class="fas fa-trash"></i> Clear All Settings & Data
            </button>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Step 1: Reference Voice -->
            <section class="card step-card" id="step1">
                <div class="card-header">
                    <span class="step-number">1</span>
                    <h2>Reference Voice</h2>
                    <span class="step-status" id="step1-status"></span>
                </div>
                <div class="card-body">
                    <p class="instruction">Record or upload a 6-10 second voice sample to clone</p>
                    <p class="instruction" style="color: #10b981; font-weight: 600;">
                        üí° Tip: If microphone doesn't work, use "Upload Audio File" button below
                    </p>
                    
                    <div class="audio-enhancement-options" style="margin-bottom: 15px; padding: 15px; background: #f3f4f6; border-radius: 8px;">
                        <h4 style="margin: 0 0 10px 0; font-size: 0.95rem;">üéôÔ∏è Audio Enhancement (Optional)</h4>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="enableNoiseReduction" style="margin-right: 8px;">
                                <span>üîá Noise Reduction - Remove background noise</span>
                            </label>
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="enableVoiceEnhancement" style="margin-right: 8px;">
                                <span>‚ú® Voice Enhancement - Improve clarity and quality</span>
                            </label>
                            <small style="color: #6b7280; font-style: italic;">
                                ‚ÑπÔ∏è Enable these for better voice cloning quality. Unchecked = original audio (no processing)
                            </small>
                        </div>
                    </div>
                    
                    <div class="voice-recorder">
                        <div class="recorder-controls">
                            <button class="btn btn-record" id="recordBtn">
                                <i class="fas fa-microphone"></i>
                                <span>Start Recording</span>
                            </button>
                            <button class="btn btn-stop" id="stopBtn" disabled>
                                <i class="fas fa-stop"></i>
                                <span>Stop Recording</span>
                            </button>
                            <div class="recording-timer" id="recordingTimer">00:00</div>
                        </div>
                        
                        <div class="audio-visualizer" id="audioVisualizer">
                            <canvas id="visualizerCanvas"></canvas>
                        </div>
                        
                        <div class="audio-player" id="audioPlayer" style="display: none;">
                            <audio controls id="audioPreview"></audio>
                            <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
                                <button class="btn btn-secondary btn-sm" id="reRecordBtn">
                                    <i class="fas fa-redo"></i> Re-record / Upload New
                                </button>
                                <span style="font-size: 0.875rem; color: #10b981; align-self: center;">
                                    ‚úÖ Voice saved! Works even after page refresh
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="divider">
                        <span>OR</span>
                    </div>
                    
                    <div class="file-upload">
                        <input type="file" id="referenceAudioFile" accept="audio/*" hidden>
                        <label for="referenceAudioFile" class="btn btn-secondary">
                            <i class="fas fa-upload"></i>
                            <span>Upload Audio File</span>
                        </label>
                        <span class="file-name" id="audioFileName"></span>
                    </div>
                </div>
            </section>

            <!-- Step 2: Text Input -->
            <section class="card step-card" id="step2">
                <div class="card-header">
                    <span class="step-number">2</span>
                    <h2>Text to Speech</h2>
                    <span class="step-status" id="step2-status"></span>
                </div>
                <div class="card-body">
                    <p class="instruction">Enter the text you want to convert to speech</p>
                    
                    <div class="form-group">
                        <label for="language">Language</label>
                        <select id="language" class="form-control">
                            <option value="en">English</option>
                            <option value="hi">Hindi (‡§π‡§ø‡§Ç‡§¶‡•Ä)</option>
                            <option value="ur">Urdu (ÿßÿ±ÿØŸà)</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                            <option value="it">Italian</option>
                            <option value="pt">Portuguese</option>
                            <option value="pl">Polish</option>
                            <option value="tr">Turkish</option>
                            <option value="ru">Russian</option>
                            <option value="nl">Dutch</option>
                            <option value="cs">Czech</option>
                            <option value="ar">Arabic</option>
                            <option value="zh-cn">Chinese</option>
                            <option value="ja">Japanese</option>
                            <option value="hu">Hungarian</option>
                            <option value="ko">Korean</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="qualityPreset">Voice Quality Preset</label>
                        <select id="qualityPreset" class="form-control">
                            <option value="realistic" selected>üé§ Most Realistic (Default)</option>
                            <option value="professional">üì∞ Professional/News</option>
                            <option value="emotional">üòä Emotional/Expressive</option>
                            <option value="educational">üìö Educational/Clear</option>
                            <option value="storytelling">üìñ Storytelling/Narrative</option>
                            <option value="conversational">üí¨ Conversational/Casual</option>
                            <option value="dramatic">üé≠ Dramatic/Theatrical</option>
                            <option value="calm">üòå Calm/Soothing</option>
                        </select>
                        <small class="form-hint" id="presetDescription">Balanced, natural sounding voice</small>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="enableAudioCleaning" style="margin-right: 8px;">
                            <span>‚ú® Clean Generated Audio - Remove noise from cloned voice</span>
                        </label>
                        <small class="form-hint" style="color: #ef4444; font-weight: 500;">
                            ‚ö†Ô∏è DISABLED by default - Audio cleaning can cause pitch/speed/volume issues. 
                            Only enable if you have background noise. Raw TTS output is usually better!
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label for="textInput">Text</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                            <button type="button" class="btn btn-secondary btn-sm" id="voiceToTextBtn">
                                <i class="fas fa-microphone"></i>
                                <span id="voiceToTextBtnText">Voice to Text</span>
                            </button>
                            <button type="button" class="btn btn-secondary btn-sm" id="stopVoiceToTextBtn" style="display: none;">
                                <i class="fas fa-stop"></i>
                                <span>Stop Listening</span>
                            </button>
                            <button type="button" class="btn btn-secondary btn-sm" id="clearTextBtn">
                                <i class="fas fa-eraser"></i>
                                <span>Clear Text</span>
                            </button>
                            <span id="voiceToTextStatus" style="align-self: center; font-size: 0.875rem; color: #6b7280;"></span>
                        </div>
                        <textarea 
                            id="textInput" 
                            class="form-control" 
                            rows="6" 
                            placeholder="Enter your text here... Use proper punctuation for natural pauses. Or click 'Voice to Text' to speak."
                        ></textarea>
                        <div class="char-count">
                            <span id="charCount">0</span> characters
                            <span id="textLengthHint" style="margin-left: 10px; font-size: 0.875rem;"></span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Step 3: Video Upload -->
            <section class="card step-card" id="step3">
                <div class="card-header">
                    <span class="step-number">3</span>
                    <h2>Video Upload</h2>
                    <span class="step-status" id="step3-status"></span>
                </div>
                <div class="card-body">
                    <p class="instruction">Upload the video where you want to add the cloned voice</p>
                    
                    <div class="file-upload">
                        <input type="file" id="videoFile" accept="video/*" hidden>
                        <label for="videoFile" class="btn btn-primary">
                            <i class="fas fa-video"></i>
                            <span>Upload Video</span>
                        </label>
                        <span class="file-name" id="videoFileName"></span>
                    </div>
                    
                    <div class="video-preview" id="videoPreview" style="display: none;">
                        <video controls id="videoPlayer" style="max-width: 100%; max-height: 300px;"></video>
                        <div class="video-info" id="videoInfo"></div>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="replaceAudio" checked>
                            Replace existing audio (uncheck to mix with original)
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label for="audioStartTime">Audio Start Time (seconds)</label>
                        <input type="number" id="audioStartTime" class="form-control" value="0" min="0" step="0.1">
                    </div>
                </div>
            </section>

            <!-- Process Button -->
            <div class="process-section">
                <button class="btn btn-process" id="processBtn" disabled>
                    <i class="fas fa-magic"></i>
                    <span>Generate Video with Cloned Voice</span>
                </button>
            </div>

            <!-- Progress Section -->
            <section class="card progress-card" id="progressCard" style="display: none;">
                <div class="card-header">
                    <h2>Processing</h2>
                </div>
                <div class="card-body">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <p class="progress-message" id="progressMessage">Initializing...</p>
                    <div class="progress-percentage" id="progressPercentage">0%</div>
                </div>
            </section>

            <!-- Result Section -->
            <section class="card result-card" id="resultCard" style="display: none;">
                <div class="card-header">
                    <h2>Result</h2>
                </div>
                <div class="card-body">
                    <div class="result-success">
                        <i class="fas fa-check-circle"></i>
                        <h3>Video Generated Successfully!</h3>
                        <p>Your video with cloned voice is ready</p>
                        
                        <div class="result-video-preview" id="resultVideoPreview" style="margin: 20px 0;">
                            <video controls id="resultVideoPlayer" style="max-width: 100%; max-height: 400px; border-radius: 8px;"></video>
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                            <button class="btn btn-primary" id="playBtn">
                                <i class="fas fa-play"></i>
                                <span>Play Video</span>
                            </button>
                            <button class="btn btn-download" id="downloadBtn">
                                <i class="fas fa-download"></i>
                                <span>Download Video</span>
                            </button>
                            <button class="btn btn-secondary" id="newProcessBtn">
                                <i class="fas fa-plus"></i>
                                <span>Create Another</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Powered by Coqui TTS (XTTS-v2) - Free & Open Source</p>
            <p>üé§ High Quality Voice Cloning | üé¨ Automatic Video Integration</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
